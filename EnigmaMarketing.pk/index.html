<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, height=device-height, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<script src='lib/three.min.js'></script>
		<script src="lib/ar.js"></script>
		<script src="lib/WebGL.js"></script>
		<script src="lib/GLTFLoader.js"></script>
		<script src="lib/sweetalert2.all.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/promise-polyfill@8/dist/polyfill.js"></script>
		<title>I am Yann</title>
	</head>
	<body style='margin : 0px; overflow: hidden; font-family: Monospace;'>
		<script>
		//////////////////////////////////////////////////////////////////////////////////
		//		Init
		//////////////////////////////////////////////////////////////////////////////////

		//Error if not WebGL compatible
		if ( WEBGL.isWebGLAvailable() === false ) {
				document.body.appendChild( WEBGL.getWebGLErrorMessage() );
		}

		// init renderer
		var renderer = new THREE.WebGLRenderer({
			antialias: true,
			autoResize: true,
			alpha: true
		});
		renderer.setClearColor(new THREE.Color('lightgrey'), 0);
		renderer.setPixelRatio(window.devicePixelRatio);
		renderer.setSize(window.innerWidth, window.innerHeight);
		renderer.domElement.style.position = 'absolute';
		renderer.domElement.style.top = '0px';
		renderer.domElement.style.left = '0px';
		document.body.appendChild(renderer.domElement);

		// array of functions for the rendering loop
		var onRenderFcts = [];

		// init scene and camera
		var scene = new THREE.Scene();
		var camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 1, 1500);
		scene.add(camera);

		var light = new THREE.AmbientLight(0xffffff); // soft white light
		light.intensity = 0.7;
		scene.add(light);

		var spotLight = new THREE.SpotLight(0xffffff, 0.7);
		spotLight.position.set(-2, 3, 5);
		spotLight.angle = 0.5 * Math.PI / 4;
		spotLight.penumbra = 1;
		spotLight.decay = 2;
		spotLight.distance = 2000;
		scene.add(spotLight);

		//////////////////////////////////////////////////////////////////////////////////
		//		Initialize AR Toolkit
		//////////////////////////////////////////////////////////////////////////////////

		var arToolkitSource = new THREEx.ArToolkitSource({
			sourceType: 'webcam'
		});

		arToolkitSource.init(function onReady() {
			onResize();
		});

		// handle resize
		window.addEventListener('resize', function () {
			onResize();
		});
		function onResize() {
			arToolkitSource.onResizeElement();
			arToolkitSource.copyElementSizeTo(renderer.domElement);
			if (arToolkitContext.arController !== null) {
				arToolkitSource.copyElementSizeTo(arToolkitContext.arController.canvas);
			}
		}

		// create atToolkitContext
		var arToolkitContext = new THREEx.ArToolkitContext({
			cameraParametersUrl: THREEx.ArToolkitContext.baseURL + '../data/data/camera_para.dat',
			detectionMode: 'mono',
			maxDetectionRate: 30,
			canvasWidth: 80 * 3,
			canvasHeight: 60 * 3,
		});
		arToolkitContext.init(function onCompleted() {
			camera.projectionMatrix.copy(arToolkitContext.getProjectionMatrix());
		});

		// update arToolkit on every frame
		onRenderFcts.push(function () {
			if (arToolkitSource.ready === false) return;
			arToolkitContext.update(arToolkitSource.domElement);
		});

		//////////////////////////////////////////////////////////////////////////////////
		//          Create a ArMarkerControls
		//////////////////////////////////////////////////////////////////////////////////
		var markerRoot = new THREE.Group();
		scene.add(markerRoot);
		var artoolkitMarker = new THREEx.ArMarkerControls(arToolkitContext, markerRoot, {
			type: 'pattern',
			patternUrl: 'marker/marker_yann.patt'
		});

		// Create a plane with video texture
		var video = document.createElement('video');
		video.src = 'https://magicsticker.github.io/your-repository-name/content/your_video.mp4'; // Path to your video
		video.load();
		video.play();
		video.loop = true;
		video.muted = true; // Optionally mute the video

		// Create video texture and apply it to a plane
		var videoTexture = new THREE.VideoTexture(video);
		var geometry = new THREE.PlaneGeometry(1, 0.75); // Aspect ratio of the video
		var material = new THREE.MeshBasicMaterial({ map: videoTexture });
		var videoMesh = new THREE.Mesh(geometry, material);
		markerRoot.add(videoMesh);

		//////////////////////////////////////////////////////////////////////////////////
		//		render the whole thing on the page
		//////////////////////////////////////////////////////////////////////////////////
		onRenderFcts.push(function () {
			renderer.render(scene, camera);
		});

		// run the rendering loop
		var lastTimeMsec = null;
		requestAnimationFrame(function animate(nowMsec) {
			requestAnimationFrame(animate);
			lastTimeMsec = lastTimeMsec || nowMsec - 1000 / 60;
			var deltaMsec = Math.min(200, nowMsec - lastTimeMsec);
			lastTimeMsec = nowMsec;
			onRenderFcts.forEach(function (onRenderFct) {
				onRenderFct(deltaMsec / 1000, nowMsec / 1000);
			});
		});
		</script>
	</body>
</html>
